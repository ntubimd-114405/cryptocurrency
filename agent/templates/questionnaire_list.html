{% extends 'base.html' %}

{% block title %}å•å·é¦–é {% endblock %}

{% block content %}

<style>
    /* Fancy Blue Button */
    .analysis {
        --fancy-button-gradient-0: #3a8bfd;
        --fancy-button-gradient-50: #297ef6;
        --fancy-button-gradient-100: #1565c0;
        --fancy-button-inner-shadow-top: rgba(180, 215, 255, 0.3);
        --fancy-button-inner-shadow-top-lg: rgba(9, 12, 60, 0.1);
        --fancy-button-inner-shadow-bottom: rgba(100, 181, 246, 0.3);
        --fancy-button-shine-top: #d0e7ff;
        --fancy-button-shine-bottom: #a6d4fa;

        font-weight: 500;
        font-size: 15px;
        line-height: 21px;
        text-shadow: 0px 0.5px 0.5px rgba(0, 0, 0, 0.2);
        padding: 0;
        margin: 0;
        appearance: none;
        border: none;
        outline: none;
        overflow: hidden;
        position: relative;
        cursor: pointer;
        z-index: 1;
        border-radius: 25px;
        color: #fff;
        background-image: linear-gradient(
            to bottom,
            var(--fancy-button-gradient-0) 0%,
            var(--fancy-button-gradient-50) 50%,
            var(--fancy-button-gradient-100) 100%
        );
        box-shadow:
            0px 4px 12px rgba(9, 12, 60, 0.15),
            0px 2px 8px rgba(9, 12, 60, 0.15),
            0px 1px 3px var(--fancy-button-inner-shadow-top-lg),
            inset 0px 1px 1px var(--fancy-button-inner-shadow-top),
            inset 0px -1px 3px var(--fancy-button-inner-shadow-bottom);
        }

    .analysis:before,
    .analysis:after {
        content: "";
        position: absolute;
        border-radius: inherit;
        will-change: transform;
    }

    .analysis:before {
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--fancy-button-shine-top);
        width: 96px;
        height: 6px;
        top: -3px;
        opacity: 0.6;
        filter: blur(6px);
        transition: opacity 0.25s;
    }

    .analysis:after {
        inset: 0;
        background-size: cover;
        z-index: 2;
        opacity: 0.3;
        mix-blend-mode: overlay;
        pointer-events: none;
    }

    .analysis span {
        display: block;
        padding: 12px 24px;
        border-radius: inherit;
        overflow: hidden;
        position: relative;
        background-image: linear-gradient(
            to bottom,
            var(--fancy-button-shine-top),
            transparent 8px
        );
        background-position: 0 -6px;
        background-repeat: no-repeat;
        z-index: 1;
    }

    .analysis span:before,
    .analysis span:after {
        content: "";
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 50%;
        background-color: var(--fancy-button-shine-bottom);
        transition:
            opacity 0.25s,
            transform 0.25s;
        will-change: transform;
    }

    .analysis span:before {
        width: 92px;
        height: 8px;
        bottom: -4px;
        opacity: 0.75;
        filter: blur(6px);
    }

    .analysis span:after {
        width: 112px;
        height: 1px;
        bottom: 0;
        opacity: 0.9;
        filter: blur(1px);
    }

    .analysis:hover span:before {
        opacity: 0.8;
        transform: translateX(-50%) scale(1.25);
    }

    .analysis:hover span:after {
        opacity: 1;
    }
</style>

<h1>å•å·é¦–é </h1>

<div class="modal-body" id="floatingTextContent">
  <!-- JS æœƒæŠŠå…§å®¹æ’é€²ä¾† -->
</div>
<div id="floatingTextTarget" class="container mt-4" style="display: none;"></div>

<!-- ğŸ”¹ ç¸½åˆ†ææŒ‰éˆ•å€å¡Š -->
<button class="analysis">
    <span>
        <a href="{% url 'agent:analyze_all_questionnaires' %}" style = "color: #fff;">
            åŸ·è¡Œç¸½åˆ†æ
        </a>
        
    </span>  
</button>
<button class = "analysis">
    <span>
        <a href="{% url 'agent:history' %}" style = "color: #fff;">
            å ±è¡¨
        </a>
    </span> 
</button>

<table class="table table-bordered align-middle text-center">
    <thead class="table-light">
        <tr>
            <th>å•å·ç·¨è™Ÿ</th>
            <th>å•å·åç¨±</th>
            <th>ä¸Šæ¬¡å¡«å¯«æ™‚é–“</th>
            <th>å¡«å¯«é€²åº¦</th> 
            <th>æ“ä½œ</th>
            <th>ChatGpt</th>
        </tr>
    </thead>
    <tbody>
        {% for item in data %}
        <tr>
            <td>{{ item.questionnaire.id }}</td>
            <td>{{ item.questionnaire.title }}</td>
            <td>
                {% if item.last_completed %}
                    {{ item.last_completed|date:"Y-m-d H:i" }}
                {% else %}
                    å°šæœªå¡«å¯«
                {% endif %}
            </td>
            <td>
                <div class="progress" style="height: 20px; position: relative;">
                    <div class="progress-bar 
                        {% if item.progress == 100 %}
                            bg-success
                        {% elif item.progress >= 50 %}
                            bg-info
                        {% elif item.progress > 0 %}
                            bg-warning
                        {% else %}
                            bg-transparent
                        {% endif %}"
                        role="progressbar"
                        style="width: {{ item.progress }}%;" 
                        aria-valuenow="{{ item.progress }}" 
                        aria-valuemin="0" 
                        aria-valuemax="100">
                    </div>
                    <!-- æ–‡å­—å›ºå®šé¡¯ç¤ºåœ¨ä¸­é–“ -->
                    <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); font-size: 0.9rem;">
                        {{ item.progress }}%
                    </span>
                </div>
            </td>
            <td style="white-space: nowrap; width: 1%;">
                <div class="d-inline-flex gap-2 justify-content-center">
                    <a class="btn btn-primary btn-sm" href="{% url 'agent:questionnaire_detail' item.questionnaire.id %}">
                        é–‹å§‹/ç¹¼çºŒå¡«å¯«
                    </a>
                    <a>|</a>
                    <form action="{% url 'agent:reset_questionnaire_answers' item.questionnaire.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm"
                                onclick="return confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç­”æ¡ˆä¸¦é‡æ–°å¡«å¯«å—ï¼Ÿ');">
                            é‡æ–°å¡«å¯«æ­¤å•å·
                        </button>
                    </form>
                </div>
            </td>
            <td>
                <a href="{% url 'agent:analyze_questionnaire' item.questionnaire.id %}">
                    åˆ†æ
                </a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">ç›®å‰æ²’æœ‰å•å·</td>
        </tr>
        {% endfor %}
    </tbody>
</table>



<div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="infoModalLabel">é‡è¦æé†’</h5>
      </div>
        <div>
            <p>äº†è§£æ‚¨æ˜¯å“ªä¸€é¡å‹çš„æŠ•è³‡äººï¼Œæ˜¯æˆåŠŸè¦åŠƒæŠ•è³‡çš„ç¬¬ä¸€æ­¥ã€‚é€éé€™ä»½å•å·ï¼Œæ‚¨å°‡èƒ½æ·±å…¥èªè­˜è‡ªå·±çš„é¢¨éšªæ‰¿å—èƒ½åŠ›ã€æŠ•è³‡æœŸé™èˆ‡ç›®æ¨™ã€‚</p>
            <p>è«‹èŠ±é»æ™‚é–“å®Œæˆé€™ä»½å•å·ï¼Œå¹«åŠ©æ‚¨é‡æ¸…å€‹äººæŠ•è³‡é¢¨æ ¼èˆ‡åå¥½ã€‚
            <strong class="text-danger">ç‰¹åˆ¥æé†’ï¼Œå•å·ç·¨è™Ÿä¸­çš„ 2ã€3ã€4ã€9 å°‡ç”¨ä¾†è¨ˆç®—æ‚¨çš„é¢¨éšªå±¬æ€§åˆ†æ•¸ï¼Œè«‹å‹™å¿…ä»”ç´°å¡«å¯«ã€‚</strong></p>
            <p>é›–ç„¶é€™ä»½å•å·æ˜¯èˆ‡è²¡å‹™é¡§å•æºé€šçš„è‰¯å¥½èµ·é»ï¼Œä½†å®ƒä¸¦ä¸å–ä»£å°ˆæ¥­é¡§å•æ‰€é€²è¡Œçš„å…¨é¢é¢¨éšªè©•ä¼°ã€‚</p>
            <p><strong>é–‹å§‹å¡«å¯«ï¼Œè®“æˆ‘å€‘ä¸€èµ·æ‰“é€ ç¬¦åˆæ‚¨éœ€æ±‚çš„æŠ•è³‡ç­–ç•¥ï¼</strong></p>
        </div>
        <template id="noticeTextTemplate">
        <div>
            <p>äº†è§£æ‚¨æ˜¯å“ªä¸€é¡å‹çš„æŠ•è³‡äººï¼Œæ˜¯æˆåŠŸè¦åŠƒæŠ•è³‡çš„ç¬¬ä¸€æ­¥ã€‚é€éé€™ä»½å•å·ï¼Œæ‚¨å°‡èƒ½æ·±å…¥èªè­˜è‡ªå·±çš„é¢¨éšªæ‰¿å—èƒ½åŠ›ã€æŠ•è³‡æœŸé™èˆ‡ç›®æ¨™ã€‚</p>
            <p>è«‹èŠ±é»æ™‚é–“å®Œæˆé€™ä»½å•å·ï¼Œå¹«åŠ©æ‚¨é‡æ¸…å€‹äººæŠ•è³‡é¢¨æ ¼èˆ‡åå¥½ã€‚
            <strong class="text-danger">ç‰¹åˆ¥æé†’ï¼Œå•å·ç·¨è™Ÿä¸­çš„ 2ã€3ã€4ã€9 å°‡ç”¨ä¾†è¨ˆç®—æ‚¨çš„é¢¨éšªå±¬æ€§åˆ†æ•¸ï¼Œè«‹å‹™å¿…ä»”ç´°å¡«å¯«ã€‚</strong></p>
            <p>é›–ç„¶é€™ä»½å•å·æ˜¯èˆ‡è²¡å‹™é¡§å•æºé€šçš„è‰¯å¥½èµ·é»ï¼Œä½†å®ƒä¸¦ä¸å–ä»£å°ˆæ¥­é¡§å•æ‰€é€²è¡Œçš„å…¨é¢é¢¨éšªè©•ä¼°ã€‚</p>
            <p><strong>é–‹å§‹å¡«å¯«ï¼Œè®“æˆ‘å€‘ä¸€èµ·æ‰“é€ ç¬¦åˆæ‚¨éœ€æ±‚çš„æŠ•è³‡ç­–ç•¥ï¼</strong></p>
        </div>
        </template>
        
      <div class="modal-footer">
        <button type="button" id="btnUnderstand" class="btn btn-primary">æˆ‘äº†è§£</button>
      </div>
    </div>
  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const modal = new bootstrap.Modal(document.getElementById('infoModal'));
    modal.show();

    const btnUnderstand = document.getElementById('btnUnderstand');
    const floatingTextContainer = document.getElementById('floatingTextContent');
    const floatingTarget = document.getElementById('floatingTextTarget');
    const template = document.getElementById('noticeTextTemplate');


    btnUnderstand.addEventListener('click', () => {
      modal.hide();

      const clone = template.content.cloneNode(true);
      const floatingDiv = document.createElement('div');
      floatingDiv.className = 'floating-copy';
      floatingDiv.appendChild(clone);
      document.body.appendChild(floatingDiv);

      const rect = floatingTextContainer.getBoundingClientRect();
      floatingDiv.style.top = `${rect.top + window.scrollY}px`;
      floatingDiv.style.left = `${rect.left + window.scrollX}px`;
      floatingDiv.style.width = `${rect.width}px`;

      setTimeout(() => {
        floatingDiv.classList.add('fly-to-top');
      }, 100);

      setTimeout(() => {
        floatingTarget.innerHTML = template.innerHTML;
        floatingTarget.style.display = 'block';
        floatingDiv.remove();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, 1300);
    });
  });
</script>


{% endblock %}
