{% extends 'base.html' %}
{% block title %}åŠ å…¥æœƒå“¡{% endblock %}
{% load static %}
{% block content %}
<script src="https://js.stripe.com/v3/"></script>
<div class="container mt-5">
    <!-- 1------------------------------------------------------------------------------------------- -->
    <div class="row align-items-center">
        <!-- å·¦é‚Šæ”¾åœ–ç‰‡ -->
        <div class="col-md-6">
            <img src="{% static 'images/logo_icon2-1.png' %}" class="img-fluid" alt="æœƒå“¡æ–¹æ¡ˆåœ–ç‰‡"
                style="max-width: 100%; height: auto;">
        </div>

        <!-- å³é‚Šæ”¾æ–‡å­— -->
        <div class="col-md-6 d-flex flex-column justify-content-center text-start">
            <h1>å‡ç´šæ‚¨çš„åŠ å¯†è²¨å¹£ä¹‹æ—… - ä½¿ç”¨ Premium å»é™¤å»£å‘Šå¹¹æ“¾ã€‚</h1>
            <small>æ¯æœˆä½è‡³ 10 ç¾å…ƒã€‚ç«‹å³è¨‚é–±ã€‚é©ç”¨<a href="{% url 'user_terms' %}">ç›¸é—œæ¢æ¬¾åŠç´°å‰‡</a></small>
            <br>
            <!-- æ–°å¢æŒ‰éˆ•ï¼Œé»æ“Šå¾Œæ»¾å‹•åˆ°æ–¹æ¡ˆé¸æ“‡å€ -->
            <button class="button-bu" id="scrollToPlansBtn">é¸æ“‡æ–¹æ¡ˆ</button>
        </div>
    </div>

    <!-- 2------------------------------------------------------------------------------------------- -->
    <h2 id="plansSection" class="text-center mt-5">é¸å–æ‚¨å–œæ­¡çš„æ–¹æ¡ˆ</h2>

    <div class="row d-flex justify-content-center">
        <!-- æ–¹æ¡ˆ A -->
        <div class="col-md-4 mb-4">
            <div class="card text-center shadow-lg">
                <div class="card-body">
                    <h5 class="card-title">æœˆåº¦</h5>
                    <small class="card-text">æŒ‰æœˆæ”¶å–ï¼Œæ¯æœˆ $10ã€‚</small>
                    <br><br>
                    <h5 class="card-title">$10<small>/æœˆ</small></h5>
                    <small class="card-text">æˆ–æŒ‰å¹´æ”¶å–ï¼ŒæŠ˜åˆæ¯æœˆ 8.32 ç¾å…ƒ</small>
                    <br><br>
                    <button class="btn btn-primary upgrade-btn" data-plan="monthly" data-price="$10/æœˆ">å‡ç´šåˆ°Premium</button>
                </div>
            </div>
        </div>
        <!-- æ–¹æ¡ˆ B -->
        <div class="col-md-4 mb-4">
            <div class="card text-center shadow-lg">
                <div class="card-body">
                    <h5 class="card-title">æ¯å¹´</h5>
                    <small class="card-text">æ¯ 12 å€‹æœˆæ”¶å– <del>$120</del> $99.90ã€‚</small>
                    <br><br>
                    <h5 class="card-title">$99.90<small>/å¹´</small></h5>
                    <small class="card-text">$8.32/æœˆ</small>
                    <br><br>
                    <button class="btn btn-primary upgrade-btn" data-plan="yearly" data-price="$99.90/å¹´">å‡ç´šåˆ°Premium</button>
                </div>
            </div>
        </div>
        <small>åƒ¹æ ¼ä¸å«ç¨…è²»ã€‚çµå¸³é é¢å°‡é¡¯ç¤ºé©ç”¨çš„ç¨…é …</small>
    </div>
    
    <!-- æ”¯ä»˜æ–¹å¼è¡¨å–® (æ¨¡æ…‹æ¡†) -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">é¸æ“‡æ”¯ä»˜æ–¹å¼</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5 id="planPrice" class="text-center"></h5> <!-- é¡¯ç¤ºé¸æ“‡çš„é‡‘é¡ -->
    
                    <form id="paymentForm" action="/process-payment/" method="POST">
                        {% csrf_token %}
                        <div class="form-group mb-3">
                            <label for="cardNumber" class="form-label">ä¿¡ç”¨å¡è™Ÿç¢¼</label>
                            <input type="text" id="cardNumber" name="cardNumber" class="form-control" placeholder="1234 5678 9012 3456" maxlength="19" required>
                        </div>
    
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="expirationDate" class="form-label">æœ‰æ•ˆæ—¥æœŸ</label>
                                <input type="text" id="expirationDate" name="expirationDate" class="form-control" placeholder="MM/YY" maxlength="5" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cvv" class="form-label">CVV</label>
                                <input type="text" id="cvv" name="cvv" class="form-control" placeholder="123" maxlength="3" required>
                            </div>
                        </div>
    
                        <button type="submit" class="btn btn-success w-100">ç¢ºèªæ”¯ä»˜</button>
                        <button type="button" class="btn btn-secondary w-100 mt-2" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript: è¡¨å–®æ§åˆ¶ -->
    <script>
        document.querySelectorAll('.upgrade-btn').forEach(function (button) {
        button.addEventListener('click', function () {
            const plan = button.getAttribute('data-plan');
            const price = button.getAttribute('data-price');
    
            document.getElementById('planPrice').textContent = `é¸æ“‡çš„æ–¹æ¡ˆé‡‘é¡ï¼š${price}`;
            document.getElementById('paymentForm').dataset.plan = plan; // å­˜æ–¹æ¡ˆé¡å‹
    
            const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
            paymentModal.show();
        });
    });

    document.getElementById('paymentForm').addEventListener('submit', function (event) {
        event.preventDefault();
        
        const plan = event.target.dataset.plan;
        const cardNumber = document.getElementById('cardNumber').value;
        const expirationDate = document.getElementById('expirationDate').value;
        const cvv = document.getElementById('cvv').value;
        console.log(cardNumber)
        fetch('/upgrade_to_premium/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'  // ç¢ºä¿ CSRF token å‚³é
            },
            body: JSON.stringify({ plan, cardNumber, expirationDate, cvv })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("å‡ç´šæˆåŠŸï¼");
                window.location.reload();
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    });

        // ç•¶å‡ç´šæŒ‰éˆ•è¢«é»æ“Šæ™‚ï¼Œé¡¯ç¤ºæ¨¡æ…‹æ¡†ä¸¦æ›´æ–°é‡‘é¡
        document.querySelectorAll('.upgrade-btn').forEach(function (button) {
            button.addEventListener('click', function () {
                const plan = button.getAttribute('data-plan');  // ä¾‹å¦‚ 'monthly' æˆ– 'yearly'
                const price = button.getAttribute('data-price');  // ä¾‹å¦‚ '$10/æœˆ'
    
                // é¡¯ç¤ºé¸æ“‡çš„é‡‘é¡
                document.getElementById('planPrice').textContent = `é¸æ“‡çš„æ–¹æ¡ˆé‡‘é¡ï¼š${price}`;
    
                // é¡¯ç¤ºæ”¯ä»˜æ¨¡æ…‹æ¡†
                const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
                paymentModal.show();
            });
        });
    
        // ä¿¡ç”¨å¡è™Ÿæ ¼å¼åŒ–
        const cardNumberInput = document.getElementById('cardNumber');
        cardNumberInput.addEventListener('input', function (event) {
            let value = event.target.value.replace(/\D/g, ''); // ç§»é™¤éæ•¸å­—
            if (value.length > 16) {
                value = value.slice(0, 16); // é™åˆ¶æœ€å¤š16ä½æ•¸å­—
            }
            value = value.match(/.{1,4}/g)?.join(' ') ?? value; // æ¯4ä½æ•¸åŠ ç©ºæ ¼
            event.target.value = value;
        });
    
        // æœ‰æ•ˆæ—¥æœŸæ ¼å¼åŒ–
        const expirationDateInput = document.getElementById('expirationDate');
        expirationDateInput.addEventListener('input', function (event) {
            let value = event.target.value.replace(/\D/g, ''); // ç§»é™¤éæ•¸å­—
            if (value.length === 1 && parseInt(value) > 1) {
                value = "0" + value; // è‡ªå‹•è£œ0
            }
            if (value.length > 4) {
                value = value.slice(0, 4); // æœ€å¤š4ä½æ•¸
            }
            if (value.length >= 3) {
                value = value.slice(0, 2) + '/' + value.slice(2);
            }
            event.target.value = value;
        });
    
        // åƒ…å…è¨±æ•¸å­—è¼¸å…¥
        document.querySelectorAll('#cardNumber, #expirationDate, #cvv').forEach(input => {
            input.addEventListener('keypress', function (event) {
                if (!/[0-9]/.test(event.key)) {
                    event.preventDefault();
                }
            });
        });
    
        // ç¢ºä¿æ¨¡æ…‹æ¡†é—œé–‰æ™‚ç§»é™¤èƒŒæ™¯é®ç½©
        document.getElementById('paymentModal').addEventListener('hidden.bs.modal', function () {
                document.querySelector('.modal-backdrop')?.remove(); // æ‰‹å‹•ç§»é™¤èƒŒæ™¯é®ç½©
                document.body.style.overflow = 'auto'; // æ¢å¾©æ»¾å‹•
                document.body.classList.remove('modal-open'); // ç§»é™¤ Bootstrap çš„é¡åˆ¥
            });

        // é¸æ“‡æ–¹æ¡ˆè·³è½‰
        document.getElementById("scrollToPlansBtn").addEventListener("click", function() {
        document.getElementById("plansSection").scrollIntoView({ behavior: "smooth" });
    });   
    </script>    

    <!-- 3------------------------------------------------------------------------------------------- -->
    <h2 class="text-center mt-5">æœƒå“¡æ–¹æ¡ˆæ¯”è¼ƒ</h2>
    <p class="text-center mb-5">æ‚¨èƒ½äº«å—ä»€éº¼?ç„¡å¹²æ“¾çš„è§€æ¸¬åŠ å¯†å¸‚å ´ä¸¦æŒçºŒé ˜å…ˆæ–¼æ›²ç·šã€‚æ”¯æŒåŠ å¯†ç©ºé–“çš„ç¨ç«‹è³‡æ–™ï¼ğŸ˜</p>
    <div class="container mt-5">

        <table class="table table-bordered text-center">
            <thead class="table-dark">
                <tr>
                    <th>åŠŸèƒ½</th>
                    <th>ä¸€èˆ¬æœƒå“¡</th>
                    <th>é«˜ç´šæœƒå“¡</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>å³æ™‚å¸‚å ´è¿½è¹¤</td>
                    <td>âœ”ï¸</td>
                    <td>âœ”ï¸</td>
                </tr>
                <tr>
                    <td>ç„¡å»£å‘Šé«”é©—</td>
                    <td>âŒ</td>
                    <td>âœ”ï¸</td>
                </tr>
                <tr>
                    <td>å³æ™‚åƒ¹æ ¼è­¦å ±</td>
                    <td>âŒ</td>
                    <td>âœ”ï¸</td>
                </tr>
                <tr>
                    <td>å¤šå¹£ç¨®æ”¯æŒ</td>
                    <td>âŒ</td>
                    <td>âœ”ï¸</td>
                </tr>
                <tr>
                    <td>é«˜ç´šè³‡æ–™åˆ†æ</td>
                    <td>âŒ</td>
                    <td>âœ”ï¸</td>
                </tr>
                <tr>
                    <td>åŠ å¯†è²¨å¹£å ±å‘Š</td>
                    <td>âŒ</td>
                    <td>âœ”ï¸</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


{% endblock %}