{% extends 'administrator/base.html' %}
{% block content %}
<div class="container mt-4">

  <h1 class="mb-4">ğŸ¤– AI è©•ä¼°åˆ†æçµæœ</h1>

  {% if error %}
    <div class="alert alert-danger" role="alert">
      {{ error }}
    </div>
  {% endif %}

  {% if total_count %}
    <div class="alert alert-info" role="alert">
      ğŸ“Š å…± {{ total_count }} ç­†å°è©±è³‡æ–™ï¼Œå…¶ä¸­ {{ analyzed_count }} ç­†åƒèˆ‡åˆ†æï¼Œ
      å‰©ä¸‹çš„æœªå®Œæˆäººå·¥åˆ†æå·²è‡ªå‹•ç•¥éã€‚
    </div>
  {% endif %}

  {% if structured_report %}
    <div class="card shadow-sm border-primary mb-4" style="border-radius:16px;">
      <div class="card-body">
        <h5 class="card-title mb-3">åˆ†ææŒ‡æ¨™</h5>

        <ul class="list-group list-group-flush">
          {% for key, val, val_float in structured_report %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>{{ key }}</strong>
              <span class="badge
                {% if val_float > 0.8 %}
                  bg-success
                {% elif val_float > 0.5 %}
                  bg-warning
                {% else %}
                  bg-danger
                {% endif %}
                rounded-pill px-3 py-2">{{ val }}</span>
            </li>
          {% endfor %}
        </ul>

      </div>
    </div>

    <!-- èªªæ˜æ–‡å­— -->
    <div class="card p-3 mb-4" style="border-radius:16px; background-color:#f8f9fa;">
      <h5 class="mb-3 text-secondary">æŒ‡æ¨™èªªæ˜èˆ‡è¨ˆç®—æ–¹å¼</h5>
      <ul class="mb-0">
        <li>
          <strong>Intent Accuracy</strong>ï¼šæ„åœ–åˆ¤æ–·æ­£ç¢ºç‡ï¼Œè¨ˆç®—æ–¹å¼ç‚ºï¼š
          <br>
          åªæœ‰ç•¶ AI é æ¸¬çš„æ„åœ–é›†åˆèˆ‡æ¨™æº–æ„åœ–é›†åˆå®Œå…¨ä¸€è‡´æ™‚ï¼Œæ‰ç®—æ­£ç¢ºï¼ˆF1=1ï¼‰ï¼Œå¦å‰‡ç®—éŒ¯ï¼š
          <br>
          <code>match = 1 if predicted == expected else 0</code>
          <br>
          æœ€å¾Œå–æ‰€æœ‰å°è©±çš„å¹³å‡å€¼ã€‚
        </li>
        <li>
          <strong>Intent F1-score</strong>ï¼šæ„åœ–åˆ¤æ–· F1 åˆ†æ•¸ï¼Œç¶œåˆç²¾ç¢ºç‡èˆ‡å¬å›ç‡ï¼š
          <br>
          å°æ¯ç­†å°è©±ï¼š
          <br>
          <code>precision = |predicted âˆ© expected| / |predicted|</code>
          <br>
          <code>recall = |predicted âˆ© expected| / |expected|</code>
          <br>
          <code>F1 = 2 * precision * recall / (precision + recall)</code>
          <br>
          æœ€å¾Œå–æ‰€æœ‰å°è©±çš„å¹³å‡å€¼ä½œç‚ºæ•´é«” F1-scoreã€‚
        </li>
        <li>
          <strong>Avg BLEU Score</strong>ï¼šå›æ‡‰ç”Ÿæˆçš„ BLEU åˆ†æ•¸ï¼Œè¡¡é‡ AI ç”Ÿæˆæ–‡å­—èˆ‡æ¨™æº–å›æ‡‰çš„ç›¸ä¼¼åº¦ï¼š
          <br>
          ä½¿ç”¨ NLTK çš„ sentence_bleuï¼Œå…ˆå°ä¸­æ–‡æ–‡æœ¬åšæ–·è©ï¼Œç„¶å¾Œè¨ˆç®— n-gram ç›¸ä¼¼åº¦ï¼Œå–æ‰€æœ‰å°è©±çš„å¹³å‡å€¼ã€‚
        </li>
        <li>
          <strong>Avg ROUGE-L Score</strong>ï¼šå›æ‡‰ç”Ÿæˆçš„ ROUGE-L åˆ†æ•¸ï¼Œè¡¡é‡ AI å›æ‡‰èˆ‡æ¨™æº–å›æ‡‰çš„é•·åº¦èˆ‡é †åºåŒ¹é…åº¦ï¼š
          <br>
          å°ä¸­æ–‡æ–‡æœ¬å…ˆæ–·è©ï¼Œä½¿ç”¨ ROUGE-L è¨ˆç®— longest common subsequenceï¼ˆLCSï¼‰æ¯”ç‡ï¼Œæœ€å¾Œå–å¹³å‡ã€‚
        </li>
        <li>
          <strong>Overall Score (Weighted)</strong>ï¼šåŠ æ¬Šç¸½åˆ†ï¼Œç¶œåˆä¸Šè¿°å„é …æŒ‡æ¨™ï¼Œè¨ˆç®—æ–¹å¼ï¼š
          <br>
          <code>overall_score = 0.5 * Intent F1-score + 0.25 * Avg BLEU Score + 0.25 * Avg ROUGE-L Score</code>
        </li>
      </ul>
    </div>
  {% endif %}

  <a href="{% url 'administrator:dialog_evaluation_list' %}" class="btn btn-outline-secondary">â† è¿”å›åˆ—è¡¨</a>

</div>
{% endblock %}
