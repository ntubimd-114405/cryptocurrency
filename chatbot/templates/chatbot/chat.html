<!DOCTYPE html> 
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>æµ®å‹•èŠå¤©è¦–çª—</title>
  <style>
    /* èŠå¤©è¦–çª—å’ŒæŒ‰éˆ•çš„æ¨£å¼ï¼ˆå¾ç¬¬ä¸€æ®µè¤‡è£½ä¾†ï¼‰ */
    .checkbox-wrapper {
        position: fixed;
        bottom: 95px;
        right: 20px;
        z-index: 9999;
    }
    .chat-btn {
        --size: 50px;
        --shadow: calc(var(--size) * .07) calc(var(--size) * .1);
        position: relative;
        display: block;
        width: var(--size);
        height: var(--size);
        margin: 0 auto;
        background-color: #4158D0;
        background-image: linear-gradient(43deg, #4158D0 0%, #C850C0 46%, #FFCC70 100%);
        border-radius: 50%;
        cursor: pointer;
        transition: 0.2s ease transform, 0.2s ease box-shadow;
        overflow: hidden;
        z-index: 1;
    }
    .chat-btn:before {
        content: "";
        position: absolute;
        top: 50%;
        right: 0;
        left: 0;
        width: calc(var(--size) * .7);
        height: calc(var(--size) * .7);
        margin: 0 auto;
        background-color: #fff;
        transform: translateY(-50%);
        border-radius: 50%;
        transition: 0.2s ease width, 0.2s ease height;
    }
    .chat-btn:hover:before {
        width: calc(var(--size) * .55);
        height: calc(var(--size) * .55);
    }
    .chat-btn:active {
        transform: scale(0.9);
    }
    .chat-btn.active {
        box-shadow: rgba(0, 0, 0, 0.3) 0px 19px 38px, rgba(0, 0, 0, 0.22) 0px 15px 12px;
    }
    .chat-btn.active:before {
        width: 0;
        height: 0;
    }
    .tick_mark {
        position: absolute;
        top: 50%;
        left: 50%;
        width: calc(var(--size) * .9);
        height: calc(var(--size) * .9);
        transform: translate(-50%, -50%);
        opacity: 0;
        transition: opacity 0.3s ease;
        background-image: none !important; /* æ¸…é™¤ç¬¬äºŒæ®µåŸæœ¬iconèƒŒæ™¯ */
    }
    .tick_mark.active {
        opacity: 1;
    }
    .tick_mark:before,
    .tick_mark:after {
        content: "";
        position: absolute;
        background-color: #fff;
        border-radius: 50% / 60%;
        transition: 0.3s ease transform;
    }
    .tick_mark:before {
        top: 10px;
        left: 5px;
        width: calc(var(--size) * .25);
        height: calc(var(--size) * .35);
        transform: translateY(15px);
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
    }
    .tick_mark:after {
        top: 10px;
        right: 5px;
        width: calc(var(--size) * .25);
        height: calc(var(--size) * .35);
        transform: translateY(15px);
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
    }
    .tick_mark:before::after,
    .tick_mark:after::after {
        content: "";
        position: absolute;
        width: calc(var(--size) * .08);
        height: calc(var(--size) * .12);
        background-color: #333;
        border-radius: 50% / 60%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .tick_mark.active:before,
    .tick_mark.active:after {
        transform: translateY(0);
    }
    .tick_mark.active:before::after,
    .tick_mark.active:after::after {
        opacity: 1;
    }
    @keyframes eyeBounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-2px); }
    }
    .tick_mark.active:before,
    .tick_mark.active:after {
        animation: eyeBounce 1.5s infinite ease-in-out;
    }
    .tick_mark.active:before {
        animation-delay: 0s;
    }
    .tick_mark.active:after {
        animation-delay: 0.2s;
    }

    /* æ€è€ƒä¸­å‹•ç•« */
    .waiting-animation {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        color: #6e8efb;
        font-style: italic;
    }
    .waiting-animation span {
        display: inline-block;
        width: 8px;
        height: 8px;
        background-color: #6e8efb;
        border-radius: 50%;
        animation: bounce 0.6s ease-in-out infinite;
    }
    .waiting-animation span:nth-child(2) {
        animation-delay: 0.2s;
    }
    .waiting-animation span:nth-child(3) {
        animation-delay: 0.4s;
    }
    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }

    /* èŠå¤©çª—å£æ¨£å¼ */
    .chat-container {
        z-index: 10;
        position: fixed;
        bottom: 158px;
        right: 20px;
        width: 350px;
        height: 450px;
        background: white;
        border-radius: 15px;
        box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);
        display: none;
        flex-direction: column;
        overflow: hidden;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .chat-container.show {
        display: flex;
        opacity: 1;
        transform: translateY(0);
    }
    .chat-header {
        background: linear-gradient(135deg, #6e8efb, #a777e3);
        color: white;
        padding: 15px;
        text-align: center;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .chat-body {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        font-size: 14px;
        background-color: #f9f9f9;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .chat-footer {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ddd;
        background-color: #fff;
    }
    .chat-footer input {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 20px;
        outline: none;
        font-size: 14px;
        background: #f1f1f1;
    }
    .chat-footer button {
        margin-left: 10px;
        padding: 10px 15px;
        background: #6e8efb;
        color: white;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    .chat-footer button:hover {
        background: #a777e3;
    }

    /* æ–°å¢å°è©±æ°£æ³¡æ¨£å¼ */
    .message {
        max-width: 75%;
        padding: 10px 15px;
        border-radius: 15px;
        line-height: 1.4;
        position: relative;
        word-wrap: break-word;
    }
    .message.user {
        background: #6e8efb;
        color: white;
        align-self: flex-end;
        margin-left: auto;
        border-bottom-right-radius: 5px;
    }
    .message.bot {
        background: #ffffff;
        color: #333;
        align-self: flex-start;
        margin-right: auto;
        border-bottom-left-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .message.waiting {
        background: #ffffff;
        color: #333;
        align-self: flex-start;
        margin-right: auto;
        border-radius: 15px;
        padding: 10px;
    }
    .chat-body > div {
        display: flex;
        flex-direction: column;
    }

    /* é è¨­å•é¡ŒæŒ‰éˆ•æ¨£å¼ */
    .chat-suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 10px;
      border-top: 1px solid #eee;
      background-color: #fff;
    }
    .chat-suggestions button {
      background-color: #f0f0f0;
      border: none;
      padding: 6px 12px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.3s;
    }
    .chat-suggestions button:hover {
      background-color: #ddd;
    }
  </style>
</head>
<body>

<!-- Chat Floating Widget -->
<div class="checkbox-wrapper">
    <div class="chat-btn" onclick="toggleChat()" id="chatBtn">
        <div class="tick_mark" id="tickMark"></div>
    </div>
</div>

<div class="chat-container" id="chatContainer">
    <div class="chat-header">
        ğŸ’¬ AI èŠå¤©åŠ©ç†
        <button onclick="clearMemory()">ğŸ§¹è¨˜æ†¶æ¸…é™¤</button>
    </div>
    <div class="chat-body" id="chat-box"></div>
    <!-- âœ… é è¨­å•é¡ŒæŒ‰éˆ•å€ -->
    <div class="chat-suggestions">
      <button onclick="sendPresetMessage('é€™å€‹ç¶²ç«™æ˜¯åšä»€éº¼çš„ï¼Ÿ')">ç¶²ç«™ä»‹ç´¹</button>
      <button onclick="sendPresetMessage('æˆ‘è©²æ€éº¼ä½¿ç”¨é€™å€‹èŠå¤©æ©Ÿå™¨äººï¼Ÿ')">ä½¿ç”¨æ•™å­¸</button>
      <button onclick="sendPresetMessage('æœ‰å“ªäº›åŠ å¯†è²¨å¹£å¯ä»¥æŸ¥è©¢ï¼Ÿ')">å¹£ç¨®æŸ¥è©¢</button>
    </div>

    <div class="chat-footer">
        <input type="text" id="message" placeholder="è¼¸å…¥è¨Šæ¯..." onkeypress="handleKeyPress(event)" />
        <button onclick="sendMessage()">ç™¼é€</button>
    </div>
</div>

<script>
const userId = 'user123';

window.onload = function () {
    const chatBox = document.getElementById('chat-box');
    const botDiv = document.createElement('div');
    botDiv.className = 'message bot';
    botDiv.innerText = 'GPTï¼šä½ å¥½ï¼Œå¯ä»¥è©¢å•æˆ‘æœ‰é—œåŠ å¯†è²¨å¹£ç›¸é—œçš„å•é¡Œå–”ï¼';
    chatBox.appendChild(botDiv);
};

// åˆ‡æ›è¦–çª—ï¼Œä¸¦åˆ‡æ›æŒ‰éˆ•å‹•ç•«
function toggleChat() {
    const container = document.getElementById('chatContainer');
    const btn = document.getElementById('chatBtn');
    const tick = document.getElementById('tickMark');

    container.classList.toggle('show');
    btn.classList.toggle('active');
    tick.classList.toggle('active');
}

// Enter è™•ç†
function handleKeyPress(event) {
    if (event.key === 'Enter') {
        event.preventDefault();
        sendMessage();
    }
}
const presetAnswers = {
    "é€™å€‹ç¶²ç«™æ˜¯åšä»€éº¼çš„ï¼Ÿ": "æ­¤ç¶²ç«™æ˜¯ä¸€å€‹åŠ å¯†è²¨å¹£æŠ•è³‡æ¨è–¦å¹³å°ï¼Œæä¾›å¤§é‡ç›¸é—œæ•¸æ“šä¾›ä½¿ç”¨è€…åƒè€ƒèˆ‡åˆ†æã€‚",
    "æˆ‘è©²æ€éº¼ä½¿ç”¨é€™å€‹èŠå¤©æ©Ÿå™¨äººï¼Ÿ": "è«‹ç›´æ¥è¼¸å…¥ä½ çš„å•é¡Œï¼Œä¾‹å¦‚ã€ŒBTC å’Œ ETH æœ€è¿‘æ€æ¨£ï¼Ÿã€æˆ–é»é¸ä¸Šæ–¹å¿«æ·å•é¡Œã€‚",
    "æœ‰å“ªäº›åŠ å¯†è²¨å¹£å¯ä»¥æŸ¥è©¢ï¼Ÿ": "ç›®å‰æœ¬ç¶²ç«™æ”¯æ´æŸ¥è©¢å¦‚ï¼šæ¯”ç‰¹å¹£ï¼ˆBTCï¼‰ã€ä»¥å¤ªå¹£ï¼ˆETHï¼‰ã€å¹£å®‰å¹£ï¼ˆBNBï¼‰ç­‰ä¸»æµåŠ å¯†è²¨å¹£ï¼Œè©³æƒ…å¯ä»¥å¾€è²¨å¹£åˆ—è¡¨æŸ¥è©¢ã€‚"
};

function sendPresetMessage(msg) {
    const chatBox = document.getElementById('chat-box');

    // é¡¯ç¤ºä½¿ç”¨è€…è¨Šæ¯
    const userDiv = document.createElement('div');
    userDiv.className = 'message user';
    userDiv.innerText = 'ä½ ï¼š' + msg;
    chatBox.appendChild(userDiv);

    // é¡¯ç¤ºéœæ…‹å›ç­”
    const botDiv = document.createElement('div');
    botDiv.className = 'message bot';
    botDiv.innerText = 'GPTï¼š' + (presetAnswers[msg] || 'å¾ˆæŠ±æ­‰ï¼Œæ²’æœ‰å°æ‡‰çš„é è¨­å›ç­”');
    chatBox.appendChild(botDiv);

    chatBox.scrollTop = chatBox.scrollHeight;
}


// ç™¼é€è¨Šæ¯
function sendMessage() {
    const input = document.getElementById('message');
    const msg = input.value.trim();
    if (!msg) return;

    const chatBox = document.getElementById('chat-box');

    const userDiv = document.createElement('div');
    userDiv.className = 'message user';
    userDiv.innerText = 'ä½ ï¼š' + msg;
    chatBox.appendChild(userDiv);

    input.value = '';

    const waitingDiv = document.createElement('div');
    waitingDiv.className = 'message bot waiting';
    waitingDiv.innerHTML = '<div class="waiting-animation"><span></span><span></span><span></span></div>';
    chatBox.appendChild(waitingDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    fetch('/chatbot/api/chat/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            user_id: userId,
            message: msg
        })
    })
    .then(res => res.json())
    .then(data => {
        waitingDiv.classList.remove('waiting');
        waitingDiv.innerText = data.error ? 'éŒ¯èª¤ï¼š' + data.error : 'GPTï¼š' + data.reply;
        chatBox.scrollTop = chatBox.scrollHeight;
    })
    .catch(() => {
        waitingDiv.classList.remove('waiting');
        waitingDiv.innerText = 'éŒ¯èª¤ï¼šè«‹æ±‚å¤±æ•—';
    });
}

// æ¸…é™¤è¨˜æ†¶
function clearMemory() {
    fetch('/chatbot/api/chat/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            user_id: userId,
            clear: true
        })
    })
    .then(res => res.json())
    .then(data => {
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML = '';
        const welcomeDiv = document.createElement('div');
        welcomeDiv.className = 'message bot';
        welcomeDiv.innerText = 'GPTï¼šä½ å¥½ï¼Œå¯ä»¥è©¢å•æˆ‘æœ‰é—œåŠ å¯†è²¨å¹£ç›¸é—œçš„å•é¡Œå–”ï¼';
        chatBox.appendChild(welcomeDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    })
    .catch(() => {
        alert('æ¸…é™¤å¤±æ•—');
    });
}
</script>

</body>
</html>
